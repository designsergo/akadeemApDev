function initMobileMenu(){var a=!1;$("header .burger").on("touchend",function(){a?($("#mmenu, .ap-icon-facebook").fadeOut(200),$(".burger, .ap-icon-facebook").css("position","absolute"),$(document).scrollTop(pageScrollPos)):($("#mmenu, .ap-icon-facebook").fadeIn(200),$(".burger, .ap-icon-facebook").css("position","fixed"),pageScrollPos=$(document).scrollTop()),$(this).toggleClass("open"),a=!a})}function loadTrainings(a,b,c){function k(a){var b=new Date(a);return("0"+b.getDate()).slice(-2)+"."+("0"+(b.getMonth()+1)).slice(-2)+"."+b.getFullYear()}a=void 0!==a?a:"EventStartDate",b=void 0!==b?b:"asc",c=void 0!==c?c:0;var d,e,f=10,g=new Date,h=g.toISOString(),i="http://poodapi.aripaev.ee/v4/Products",j={$select:"Id,Name,SubTitle,EventStartDate,EventEndDate,AdditionalDescription,ProductPersons",$filter:"Deleted eq false and ProductTemplateId eq 4 and EventStartDate ge "+h,$expand:"ProductPersons($expand=Person($select=FirstName,LastName))",$orderby:a+" "+b,$top:f,$skip:c,$count:"true"};i+="?"+$.param(j),$.ajax({method:"GET",timeout:5e3,url:i}).fail(function(a){console.log("loadTrainings: ERROR contacting poodapi.aripaev.ee!",a)}).done(function(a){if(d=a["@odata.count"],0===(e=a.value.length))return void $("#trainings-table .loading").html('<p class="error">Koolitusi ei leitud!</p>');$("#trainings-table .placeholder, #trainings-table .table-row, #trainings-table .table-footer").remove(),$("#trainings-table .loading").fadeOut(100),$(a.value).each(function(a){var b=$(this)[0],c=new Date(b.EventStartDate)<new Date(b.EventEndDate)?k(b.EventStartDate)+" - "+k(b.EventEndDate):k(b.EventStartDate);b.ProductPersons.length>0&&(firstName=b.ProductPersons[0].FirstName?b.ProductPersons[0].FirstName:b.ProductPersons[0].Person.FirstName,lastName=b.ProductPersons[0].LastName?b.ProductPersons[0].LastName:b.ProductPersons[0].Person.LastName),subtitle=null!==b.SubTitle?b.SubTitle:"";var d='<div class="table-row"><a href="http://pood.aripaev.ee/Product/ProductDetails?productId='+b.Id+'" target="_blank"><div class="table-cell date">'+c+'</div><div class="table-cell title"><h3>'+b.Name+"</h3><p>"+subtitle+'</p></div><div class="table-cell duration hidden-xs">'+b.AdditionalDescription+'</div><div class="table-cell trainer">'+firstName+" "+lastName+'</div><div class="table-cell more"><span class="text hidden-xs">Vaata l√§hemalt</span><span class="ap-icon-arrow-a"></span></div></a></div>';$("#trainings-table .items").append(d)});for(var b=d/f,c='<div class="table-footer">',g=0;g<Math.ceil(b);g++){var h=g+1,i=h*f-f,j=Math.ceil(b)-1==g?d:h*f;c+='<a class="'+(activePage==h?"active":"")+'" href="#'+h+'" data-offset="'+i+'" data-pagenr="'+h+'">'+(i+1)+"-"+j+"</a>"}c+="</div>",$("#trainings-table .items").append(c),$(".table-footer a").click(function(a){a.preventDefault(),$("#trainings-table").scrollToTrainings(),$("#trainings-table .loading").fadeIn(100),loadTrainings(activeSort,activeOrder,$(this).data("offset")),activePage=$(this).data("pagenr"),activeOffset=$(this).data("offset")})})}function refreshTrainings(a,b){$("#trainings-table .loading").fadeIn(100),b.hasClass("active")?(b.hasClass("asc")?(loadTrainings(a,"desc",activeOffset),activeOrder="desc"):(loadTrainings(a,"asc",activeOffset),activeOrder="asc"),b.toggleClass("asc")):(b.hasClass("asc")?loadTrainings(a,"asc",activeOffset):loadTrainings(a,"desc",activeOffset),b.addClass("active").siblings().removeClass("active"))}function initTrainings(){loadTrainings(),$("#trainings-table .table-cell.date").click(function(){refreshTrainings("EventStartDate",$(this),activeOffset),activeSort="EventStartDate"}),$("#trainings-table .table-cell.title").click(function(){refreshTrainings("Name",$(this),activeOffset),activeSort="Name"}),$("#trainings-table .table-cell.duration").click(function(){refreshTrainings("AdditionalDescription",$(this),activeOffset),activeSort="AdditionalDescription"})}var viewportHeight=Math.max(document.documentElement.clientHeight,window.innerHeight||0),viewportWidth=Math.max(document.documentElement.clientWidth,window.innerWidth||0);$(function(){viewportWidth<768&&initMobileMenu(),$("#trainings-table").length>0&&initTrainings(),viewportWidth>=768&&$("header.vertical .bg-slant").css("height",$("body").height()+250+"px")}),$(window).scroll(function(){$(window).scrollTop()>0&&viewportWidth>1024?$("header.slant").addClass("vertical"):$("header.slant").removeClass("vertical")});var activeSort="EventStartDate",activeOrder="asc",activePage=1,activeOffset=0;if($.fn.extend({scrollToTrainings:function(){var a=jQuery(this).offset().top-30;jQuery("html,body").animate({scrollTop:a},200)}}),$(".upcoming").length>0){var eventItem=$(".upcoming .event"),total=eventItem.length,margin=0,first=1;viewportWidth>768&&eventItem.width(($(".upcoming").width()-30)/2),total>2&&$(".upcoming .page-nav").show(),$(".upcoming .page-nav").click(function(){$(this).hasClass("next")&&first!=total-1&&total>2?(margin-=eventItem.outerWidth(!0),$(".upcoming .events").css("margin-left",margin+"px"),first++):$(this).hasClass("prev")&&1!=first&&(margin+=eventItem.outerWidth(!0),$(".upcoming .events").css("margin-left",margin+"px"),first--),first>1?$(".upcoming .page-nav.prev").removeClass("disabled"):$(".upcoming .page-nav.prev").addClass("disabled"),first!=total-1?$(".upcoming .page-nav.next").removeClass("disabled"):$(".upcoming .page-nav.next").addClass("disabled")}),window.addEventListener("orientationchange",function(){viewportWidth>768&&eventItem.width(($(".upcoming").width()-30)/2)})}